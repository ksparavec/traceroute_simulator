<!DOCTYPE html>
<html>
<head>
    <title>PDF Debug</title>
</head>
<body>
    <h1>PDF Display Debug</h1>
    
    <h2>Response Headers Check</h2>
    <pre id="headers">Checking headers...</pre>
    
    <h2>Direct PDF in Object Tag</h2>
    <object id="pdfObject" type="application/pdf" width="100%" height="600px">
        <p>PDF not displayed inline</p>
    </object>
    
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const runId = urlParams.get('id');
        const sessionId = urlParams.get('session');
        
        const pdfUrl = `/cgi-bin/pdf_viewer.py?id=${runId}&session=${sessionId}`;
        
        // Check response headers
        fetch(pdfUrl, { method: 'HEAD' })
            .then(response => {
                const headers = {};
                response.headers.forEach((value, key) => {
                    headers[key] = value;
                });
                document.getElementById('headers').textContent = JSON.stringify(headers, null, 2);
                
                // Check for problematic headers
                if (headers['x-frame-options']) {
                    console.warn('X-Frame-Options:', headers['x-frame-options']);
                }
                if (headers['content-security-policy']) {
                    console.warn('CSP:', headers['content-security-policy']);
                }
            })
            .catch(err => {
                document.getElementById('headers').textContent = 'Error: ' + err.message;
            });
        
        // Set PDF URL
        document.getElementById('pdfObject').data = pdfUrl;
        
        // Also log current document's CSP meta tag if any
        const cspMeta = document.querySelector('meta[http-equiv="Content-Security-Policy"]');
        if (cspMeta) {
            console.log('CSP meta tag:', cspMeta.getAttribute('content'));
        }
    </script>
</body>
</html>