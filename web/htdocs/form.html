<!DOCTYPE html>
<html>
<head>
    <title>Network Reachability Test</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="/js/form.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Network Reachability Test</h1>
            <a href="/cgi-bin/logout.py" class="logout">Logout</a>
        </header>
        
        <form id="reachability-form" action="/cgi-bin/main.py" method="POST">
            <div class="form-group">
                <label for="source_ip">Source IP Address *</label>
                <input type="text" id="source_ip" name="source_ip" 
                       pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$" 
                       required placeholder="e.g., 10.1.1.1">
            </div>
            
            <div class="form-group">
                <label for="source_port">Source Port (optional)</label>
                <input type="number" id="source_port" name="source_port" 
                       min="1" max="65535" placeholder="e.g., 12345">
            </div>
            
            <div class="form-group">
                <label for="dest_ip">Destination IP Address *</label>
                <input type="text" id="dest_ip" name="dest_ip" 
                       pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$" 
                       required placeholder="e.g., 10.2.1.1">
            </div>
            
            <div class="form-group">
                <label for="port_mode">Port Selection Mode *</label>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" name="port_mode" value="quick" checked onchange="togglePortMode()">
                        Quick Select (Common Services)
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="port_mode" value="manual" onchange="togglePortMode()">
                        Manual Entry (Advanced)
                    </label>
                </div>
            </div>
            
            <!-- Quick Select Mode -->
            <div id="quick_select_group" class="form-group">
                <label for="quick_ports">Select Services</label>
                <select id="quick_ports" name="quick_ports" multiple size="10" class="service-select">
                    <!-- Options will be loaded dynamically from config -->
                </select>
                <div class="help-text">Hold Ctrl/Cmd to select multiple services</div>
            </div>
            
            <!-- Manual Entry Mode -->
            <div id="manual_entry_group" class="form-group" style="display: none;">
                <label for="dest_ports">Destination Ports</label>
                <input type="text" id="dest_ports" name="dest_ports" 
                       placeholder="e.g., 22/tcp,80,443/tcp,1000-2000/udp"
                       title="Enter ports as: 22/tcp, 80, 443/tcp, 1000-2000/udp"
                       pattern="^[0-9,/a-z\-\s]+$"
                       oninput="this.setCustomValidity('')">
                <div class="help-text">
                    Format: port[/protocol], port-range[/protocol], comma-separated<br>
                    Examples: 22/tcp, 80, 443/tcp, 1000-2000/udp, 53/tcp,53/udp
                </div>
            </div>
            
            <div class="form-group">
                <label for="default_protocol">Default Protocol (for unspecified ports) *</label>
                <select id="default_protocol" name="default_protocol" required>
                    <option value="tcp" selected>TCP</option>
                    <option value="udp">UDP</option>
                </select>
            </div>
            
            <!-- Hidden field for user trace data -->
            <input type="hidden" id="user_trace_data" name="user_trace_data" value="">
            
            <div class="form-actions">
                <button type="submit">Run Test</button>
                <button type="button" onclick="clearForm()">Clear</button>
                <button type="button" onclick="openTraceFileInput()">Trace File Input</button>
            </div>
        </form>
        
        <!-- Modal for trace file input -->
        <div id="traceModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Trace File Input</h2>
                    <span class="close" onclick="closeTraceModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <p>Paste your trace file JSON content below:</p>
                    <textarea id="traceJsonInput" placeholder="Paste JSON trace data here..." rows="15"></textarea>
                    <div id="jsonValidationError" class="error-message" style="display: none;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" onclick="validateAndSaveTrace()">Save</button>
                    <button type="button" onclick="clearTraceInput()">Clear</button>
                    <button type="button" onclick="closeTraceModal()">Cancel</button>
                </div>
            </div>
        </div>
        
        <div class="info">
            <p>This tool will generate a comprehensive network reachability report including:</p>
            <ul>
                <li>Network path trace</li>
                <li>Connectivity tests (ping, MTR, service)</li>
                <li>Firewall rule analysis</li>
                <li>Visual network diagram</li>
            </ul>
        </div>
    </div>
</body>
</html>